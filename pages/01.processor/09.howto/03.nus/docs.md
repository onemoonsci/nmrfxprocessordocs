---
title:  NUS Data Processing
taxonomy:
    category: docs
---


Conventional NMR data acquisition collects the indirect time points with equal spacing.  This uniform spacing is appropriate for the use of the Fourier Transform algorithm to convert data from the time domain to the frequency domain.  Recently, there has been much progress in the use of non-uniformly sampled (NUS) data acquisition.  These NUS methods allow data to be collected more rapidly, by skipping the acquistion of some time points according to a specified schedule.  This allows for higher resolution datasets to be collected in the same time it would take to collect a lower resolution data set with conventional sampling.  Processing of these NUS datasets with a conventional Fourier Transform results in the presence of significant artifacts in the processed data.  

Development of new algorithms that are appropriate for processing NUS data is an active area of research.  NMRFx Processor currently provides two internal methods for processing the data and we are actively working on additional algorithms. Also, we provide protocols for using external programs.  The internal methods include IST (iterative soft thresholding) and NESTA (the Nesterov Algorithm). 

Processing of 2D datasets requires addition of only a single operation at the beginning of the DIM(2) processing operations.  The first dimension is processed with the normal DIM(1) commands.  The NUS processing command at the beginning of the indirect dimension processing replaces the non-sampled data points in each vector with data values estimated using the selected algorithm. Two operations are currently available, IST and NESTA. 

Processing of higher dimensional datasets requires addition of a single operation in a special multi-dimensional processing step.  Processing of the first (direct) dimension of the dataset happens as with normal datasets with operations specified for DIM(1).  Next, planes (or higher dimensional objects for 4D or higher dimensional datasets) are processed with the NUS algorithm.  After this step the dataset will have been updated with estimated (according to the NUS algorithm) values for the non-sampled points.  Processing of the dataset then continues with normal processing for each indirect dimension.

The "Gen All Dims" menu command used to automatically build a processing script will recognize NUS data by virtue of the presence of a sample schedule file. At present, the code looks for a file named "sampling.sch" in Agilent datasets and "nuslist" in Bruker datasets. If your schedule file has a different name you should rename (or copy) it so it has one of these names. 

The internal NUS processing algorithms (IST and NESTA) currently in NMRFx Processor require that the indirect dimensions are properly phased.  Ideally, the experiment will have been collected with a pulse sequence and acquisition parameters that don't require phasing of the indirect dimensions.  If not, these operations have a parameter where phase values can be set.  Each indirect data object (vector for 2D, plane for 3D, etc.) will be phased as a first step of the NUS operation.  Phases are typically entered for these operations as a list of values like: ph0-D2,ph1-D2,ph0-D2,ph1-D2, where ph0-D2 represents the zero-order phase value for dimension 2 of the dataset (first indirect dimension).  If all values after a certain value are zero, they can be left off.  For example, a 3D dataset requiring only a 45.0 zero order phase shift for the 2nd dimension would only requiring specifying the 45.0 value.

Given the active research in developing new methods for NUS data processing we have also provided protocols for calling external software. Currently there is built=in support for using a modified version of the NESTANMR program.  Other programs can be used if hey are modified to read and write an intermediate file format that can be written by NMRFx Processor.  This file format is described in the chapter on [File Formats](files).  Development of nmrPipe import export is currently under development to allow the use of programs that are written to use the nmrPipe format.
